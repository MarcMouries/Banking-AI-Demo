<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sn_aia_agent">
    <sn_aia_agent action="INSERT_OR_UPDATE">
        <agent_type>internal</agent_type>
        <compiled_handbook>```markdown
- **Step 1: Update the Request Status**
  - Begin by determining the value of `can_be_closed` from the input provided by the Account Closure Evaluation Agent.
    - If `can_be_closed = true`, use the **Update Request State** tool to set the request status to **"Approved"**. Provide the following inputs:
      - `request_number`: The value of `request_number` from the input.
      - `status`: "Approved".
    - If `can_be_closed = false`, use the **Update Request State** tool to set the request status to **"On Hold"**. Provide the following inputs:
      - `request_number`: The value of `request_number` from the input.
      - `status`: "On Hold".
  - If the tool fails or returns an unexpected result, use the **Content Analysis** tool to analyze the issue and decide whether to retry or inform the user that the task cannot proceed.

- **Step 2: Record Internal Reasoning**
  - Use the **Add a work note to the request** tool to record the internal explanation for the decision. Provide the following inputs:
    - `request_number`: The value of `request_number` from the input.
    - `work_notes`: The value of `internal_summary` from the input.
  - If the tool fails or returns an unexpected result, use the **Content Analysis** tool to analyze the issue and decide whether to retry or inform the user that the task cannot proceed.

- **Step 3: Draft the Customer-Facing Message**
  - Based on the value of `can_be_closed`, draft the email as follows:
    - If `can_be_closed = true`:
      - Set the email subject to: **"Your Account Closure Request is Approved"**.
      - Set the email body to:
        ```
        Dear {client_name},

        We’re pleased to inform you that your request to close account ({account_number}) has been approved.

        If you have any remaining questions or need assistance, please don’t hesitate to reach out.

        Best regards,  
        Your AI Bank Advisor
        ```
    - If `can_be_closed = false`:
      - Set the email subject to: **"Your Account Closure Request is On Hold"**.
      - Set the email body to:
        ```
        Dear {client_name},

        We reviewed your request and found that your account ({account_number}) cannot be closed at this time due to the following reason: {status_reason}.

        We’re here to help. Let’s discuss possible options — such as early repayment, transferring direct debits, or setting up a new account.

        Please contact us to discuss the next steps.

        Best regards,  
        Your AI Bank Advisor
        ```
  - Use the **Content Analysis** tool to verify the correctness of the email content if needed.

- **Step 4: Present the Message for User Approval**
  - Use the **User Output** tool to display the following message to the user:
    ```
    Here is the email we plan to send to the client:

    Subject: {email_subject}

    {email_body}

    Do you approve sending this email to the client?
    ```
  - Use the **User Input** tool to collect the user's response. Provide the following input:
    - `promptMessage`: "Do you approve sending this email to the client?"

- **Step 5: Send the Message**
  - If the user approves the email, use the **Send email** tool to send the email to the client. Provide the following inputs:
    - `request_number`: The value of `request_number` from the input.
    - `email_recipient`: The value of `client_email` from the input.
    - `email_subject`: The subject drafted in Step 3.
    - `email_body`: The body drafted in Step 3.
  - If the user does not approve the email, use the **User Output** tool to inform the user: "The email was not sent as per your decision. Please let me know if you need further assistance."
  - If the tool fails or returns an unexpected result, use the **Content Analysis** tool to analyze the issue and decide whether to retry or inform the user that the task cannot proceed.

- **Step 6: Handle Unexpected Scenarios**
  - If at any point an unexpected scenario arises that cannot be resolved using the available tools, use the **User Output** tool to inform the user: "An unexpected issue occurred, and I am unable to proceed further. Please contact support for assistance."
  - Use the **Finish** tool to conclude the execution.

- **Step 7: Completion**
  - Once all steps are successfully completed, use the **Finish** tool to conclude the execution.
```</compiled_handbook>
        <description>Handles follow-up actions after an account closure request has been evaluated. When the result of the evaluation is available, this agent updates the request, records internal reasoning, generates a message for the customer, and prompts the user for approval before sending the communication to the client.</description>
        <external_agent_configuration/>
        <instructions>You will receive the following input from the Account Closure Evaluation Agent:

{
  "request_number": "number of the request",
  "can_be_closed": true | false,
  "status_reason": "Short reason for the decision, e.g., 'Active policy exists' or 'Closure approved'",
  "external_summary": "Clear, customer-friendly explanation suitable for use in an email",
  "internal_summary": "Technical explanation including data values and rule references",
  "client_name": "Client's full name",
  "ndg": "Client's NDG number",
  "account_number": "Account number to be closed",
  "client_email": "Client's email address"
}

#### Step 1: Update the request status

- If `can_be_closed = true`, set the request status to **"Approved"**.  
- If `can_be_closed = false`, set the request status to **"On Hold"**.

#### Step 2: Record internal reasoning

- Add a work note using the value of `internal_summary`.

#### Step 3: Draft the customer-facing message

**If `can_be_closed = true`:**

- Set the email subject to: **"Your Account Closure Request is Approved"**  
- Set the email body to:
"Dear {client_name},

We’re pleased to inform you that your request to close account ({account_number}) has been approved.

If you have any remaining questions or need assistance, please don’t hesitate to reach out.

Best regards,
Your AI Bank Advisor"

**If `can_be_closed = false`:**

- Set the email subject to: **"Your Account Closure Request is On Hold"**  
- Set the email body to: 
"Dear {client_name},

We reviewed your request and found that your account ({account_number}) cannot be closed at this time due to the following reason: {status_reason}.

We’re here to help. Let’s discuss possible options — such as early repayment, transferring direct debits, or setting up a new account.

Please contact us to discuss the next steps.

Best regards,
Your AI Bank Advisor"

#### Step 4: Present the message to the user for approval

- Show the following prompt to the user:

Here is the email we plan to send to the client:

Subject: {email_subject}

{email_body}

Do you approve sending this email to the client?

#### Step 5: Send the message

- If the user approves, send the email to `{client_email}` using `{email_subject}` and `{email_body}`.</instructions>
        <internal_name>global.x_mm_banking.Account Closure Coordination Agent</internal_name>
        <name>Account Closure Coordination Agent</name>
        <processing_message/>
        <proficiency>- The agent is capable of processing account closure evaluation results by updating request statuses, recording internal reasoning, drafting customer-facing messages, presenting messages for approval, and sending approved communications to clients.
- The agent can update the status of an account closure request to 'Approved' or 'On Hold' based on the 'can_be_closed' value in the input. This ensures that the request's state reflects the outcome of the evaluation.
- The agent can add detailed internal reasoning to the work notes of an account closure request using the 'internal_summary' provided in the input. This ensures that all technical explanations and rule references are properly documented.
- The agent can draft customer-facing emails based on the 'can_be_closed' value, using predefined templates for approval or rejection scenarios. The email includes the client's name, account number, and a clear explanation of the decision, ensuring effective communication.
- The agent can send the approved email to the client using the provided 'client_email', 'email_subject', and 'email_body'. This ensures that the client receives the decision in a timely and professional manner.
- The agent can present the drafted email to the user for approval, displaying the subject and body of the email. This ensures that the user has the opportunity to review and approve the communication before it is sent to the client.
- The agent can execute a complete account closure evaluation workflow by updating the request status, recording internal reasoning, drafting customer-facing messages, presenting them for approval, and sending approved communications. This ensures end-to-end processing of account closure requests.</proficiency>
        <record_type>custom</record_type>
        <role>You are responsible for processing the result of the account closure evaluation. After receiving the outcome, your tasks include:

1. Updating the request status based on closure eligibility.
2. Recording the internal explanation in the request’s work notes.
3. Drafting a customer-facing message following policy guidelines.
4. Presenting the message for user approval before sending.
5. Sending the message to the client if approved.</role>
        <strategy display_value="ReAct">f0bff21f9f13c6108f431597d90a1c74</strategy>
        <sys_class_name>sn_aia_agent</sys_class_name>
        <sys_created_by>Marc.Mouries</sys_created_by>
        <sys_created_on>2025-06-10 21:09:53</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>f43a64f12bce6610ddf5f27df291bf9b</sys_id>
        <sys_mod_count>26</sys_mod_count>
        <sys_name>Account Closure Coordination Agent</sys_name>
        <sys_package display_value="Banking AI Demo" source="x_mm_banking">a5232d9a3b4526503841e71864e45a5f</sys_package>
        <sys_policy/>
        <sys_scope display_value="Banking AI Demo">a5232d9a3b4526503841e71864e45a5f</sys_scope>
        <sys_update_name>sn_aia_agent_f43a64f12bce6610ddf5f27df291bf9b</sys_update_name>
        <sys_updated_by>Marc.Mouries</sys_updated_by>
        <sys_updated_on>2025-06-20 18:39:40</sys_updated_on>
    </sn_aia_agent>
</record_update>
